# MCG 设计文档

HEAD | SUMMARY
-----|--------
Author:| All mcg members  
Status:| Draft
Date:| 5-April-2019

## 流程

### 请求首页
前端发起get请求，获取首页，path = "/index.html"。

首页信息包含3块内容，"校选修、院选修、体育选修"，页面内容、格式自行设计。

### 前端请求课程信息

#### 客户端点击
前端点击"校选修、院选修、体育选修"中的任何一个时，立即向服务端发起请求，获取**全量**课程目录，自行决定如何展示。

目录信息获取到之后，立刻发起第2个请求，获取课程的剩余人数，这里采用分页请求的方式，前端自行决定一次请求查询多少页的课程剩余人数。客户端发起的请求中，应包含要查询的课程名列表。

#### 服务端回应
客户端查询课程目录时，全量返回。

客户端查询剩余人数时，根据客户端要查询的课程名列表，进行"数据库操作"。

"数据库操作"是这样的一个流程(下同)：判断是否"空闲",
* 如果是，直接返回结果。
* 如果繁忙，产生一个排队id(**必须保证全局唯一**),并构建合适的数据结构，插入队列。

#### 客户端决策
* 如果服务端返回一个排队id，则进行"等待操作"，定时轮询，轮询请求中需要携带这个排队id。
* 如果服务端返回了结果，则展示。

### 前端提交选课结果

#### 客户端点击
客户端记录用户选择的课程名(可能是多个，自行决定是否做单次提交数量限制)，判断此次提交的课程是否存在时间冲突。如果冲突，放弃提交即可（demo阶段不做任何人性化的操作)。

前端向服务端提交此次用户选择的课程名称，等待服务端返回结果。

#### 服务端回应
* 服务端获取这个学生的课表。遍历提交的选课列表，判断课程时间与课表时间是否冲突，从提交的选课列表中去除冲突课程。
* 遍历不冲突课程列表，**对每一个课程**进行"数据库操作"

*注：这里只要允许选课部分成功，部分失败即可，具体怎么操作再定*

#### 客户端决策
* 如果服务端返回排队id列表，则进行等待，定时轮询，轮询请求中需要带上**这些**排队id.
* 如果服务端返回了结果，则展示。

### 前端取消已选课程
流程上一模一样，暂不考虑。


## 前端处理
## http请求参数
茹鑫补充。
## 前端轮询策略

## Nginx配置

## 服务端处理

### 服务端如何处理http请求

### "数据库操作" 细节描述
涂涂补充。

## 数据库
### 数据库说明文档
#### 1.总共11张表
学院表 mcg_institute
专业表 mcg_major
班级表 mcg_class
用户表 mcg_user
学生表 mcg_user_student
老师表 mcg_user_teacher
课程基本信息表 mcg_course_basic
课程表 mcg_course
课程时间表 mcg_course_timerange
学生选课信息表 mcg_student_course_relation
选课中课程信息表 mcg_course_remain

#### 2.表结构的设计理念
每张表都有一个主键来唯一标识这张表的记录，为了统一标准，这个主键的字段名都为id。
其他表若是想要获取另一张表的信息，可以通过记录这张表的id来关联查找。
其他表用来记录另一张表的id的字段名一般为另一张表的表名的简写加上id，例如在课程时间表中我要知道这条记录的时间是属于哪个课程的，我就会创建一个字段叫做courseId，它的值就等于我想要关联的课程表中的那条记录的id。
通常要对用来关联的字段例如courseId建立索引。

#### 3.表结构分析
学院表 mcg_institute
* 主键
* 学院名称

专业表 mcg_major
* 主键
* 学院id：用来关联学院表，获得这个专业所属的学院的信息
* 专业名称

班级表 mcg_class
* 主键
* 学院id：用来关联专业表，获得这个班级所属的专业的信息
* 班级名称

用户表 mcg_user
* 主键
* 学号或工号
* 密码
* 类型：老师或学生
* 名字

学生表 mcg_user_student
* 主键
* 用户id：用来关联用户表，获得这个学生的基本用户信息
* 班级id：用来关联班级表，获得这个学生的班级信息

老师表 mcg_user_teacher
* 主键
* 用户id：用来关联用户表，获得这个老师的基本用户信息
* 学院id：用来关联学院表，获得这个老师所属信息

课程基本信息表 mcg_course_basic
* 主键
* 编码
* 课程名称
* 这门课的时长
* ps：这张表主要用来存课程的一些基本信息，这考虑到有些课程他们其实是一门课程，但是在不同的专业中被选，授课老师可能也不同，但他们的一些基本信息是相同的

课程表 mcg_course
* 主键
* 课程基本信息id：用来关联课程基本信息表，获得这门课程的基本信息
* 批次：用来标识这是那批进行的选课，可以用来筛选出这次选课的课程
* 编码：也是唯一标识，也用来前端展示，选课时的课程都应该是不同的编码，即使同一门课程，教授的老师不同，那他们的编码也不同
* 老师id：用来关联老师表的主键，获取这门课的授课老师信息
* 类型：院选还是校选
* 专业id：是可空的，校选可以没有专业id
* 总数量
* 剩余数量
* ps：这张表保存的是在选课时展示的真正的课程信息了，每批选课都会新建，把原来的数量也放到这里了

课程时间表 mcg_course_timerange
* 主键
* 课程id：用来关联课程基本表，一般是通过课程id这个字段查出某门课程的时间段
* 星期几
* 第几节课开始
* 第几节课结束

学生选课信息表 mcg_student_course_relation
* 主键
* 学生id
* 课程id
* ps：在学生选课成功后需要将学生和他所选的课的id保存到这张表，以便知道一个学生选了什么课




























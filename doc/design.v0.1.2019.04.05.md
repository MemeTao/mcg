# MCG 设计文档

HEAD | SUMMARY
-----|--------
Author:| All mcg members  
Status:| Draft
Date:| 5-April-2019

## 流程

### 请求首页
前端发起get请求，获取首页，path = "/index.html"。

首页信息包含3块内容，”校选修、院选修、体育选修"，页面内容、格式自行设计。

### 前端请求课程信息

#### 客户端点击
前端点击”校选修、院选修、体育选修"中的任何一个时，立即向服务端发起请求，获取**全量**课程目录，自行决定如何展示。

目录信息获取到之后，立刻发起第2个请求，获取课程的剩余人数，这里采用分页请求的方式，前端自行决定一次请求查询多少页的课程剩余人数。客户端发起的请求中，应包含要查询的课程名列表。

#### 服务端回应
客户端查询课程目录时，全量返回。

客户端查询剩余人数时，根据客户端要查询的课程名列表，进行"数据库操作"。

”数据库操作”是这样的一个流程(下同)：判断是否"空闲",
* 如果是，直接返回结果。
* 如果繁忙，产生一个排队id(**必须保证全局唯一**),并构建合适的数据结构，插入队列。

#### 客户端决策
* 如果服务端返回一个排队id，则进行”等待操作"，定时轮询，轮询请求中需要携带这个排队id。
* 如果服务端返回了结果，则展示。

### 前端提交选课结果

#### 客户端点击
客户端记录用户选择的课程名(可能是多个，自行决定是否做单次提交数量限制)，判断此次提交的课程是否存在时间冲突。如果冲突，放弃提交即可（demo阶段不做任何人性化的操作)。

前端向服务端提交此次用户选择的课程名称，等待服务端返回结果。

#### 服务端回应
* 服务端获取这个学生的课表。遍历提交的选课列表，判断课程时间与课表时间是否冲突，从提交的选课列表中去除冲突课程。
* 遍历不冲突课程列表，**对每一个课程**进行"数据库操作"

*注：这里只要允许选课部分成功，部分失败即可，具体怎么操作再定*

#### 客户端决策
* 如果服务端返回排队id列表，则进行等待，定时轮询，轮询请求中需要带上**这些**排队id.
* 如果服务端返回了结果，则展示。

### 前端取消已选课程
流程上一模一样，暂不考虑。


## 前端处理
## http请求参数
茹鑫补充。
## 前端轮询策略

## Nginx配置

## 服务端处理

### 服务端如何处理http请求

### ”数据库操作" 细节描述
涂涂补充。

## 数据库
### 数据库表结构
乐乐补充。

